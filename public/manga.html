<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manga Details</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/manga-detail.css">
    <link rel="stylesheet" href="css/user-actions.css">
    <link rel="stylesheet" href="css/list-modal.css">
    <link rel="stylesheet" href="css/list-badges.css">
    <link rel="stylesheet" href="css/toast.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <a href="/" class="logo">Manga Reader</a>
                <nav class="nav">
                    <a href="/" class="nav-link">Library</a>
                    <a href="reader.html" class="nav-link">Reader</a>
                </nav>
            </div>
        </header>

        <!-- Loading State -->
        <div class="loading-container" id="loadingContainer">
            <div class="loading-spinner"></div>
            <p class="loading-text">Loading manga details...</p>
        </div>

        <!-- Manga Detail Content -->
        <div class="manga-detail" id="mangaDetail" style="display: none;">
            <!-- Cover and Info Section -->
            <div class="manga-header">
                <div class="manga-cover">
                    <img id="mangaThumbnail" src="" alt="Cover">
                </div>
                <div class="manga-meta">
                    <h1 id="mangaTitle" class="title">Loading...</h1>
                    <p id="altTitles" class="alt-titles"></p>
                    
                    <div class="meta-grid">
                        <div class="meta-item">
                            <span class="meta-label">Author:</span>
                            <span id="author" class="meta-value">Unknown</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Artist:</span>
                            <span id="artist" class="meta-value">Unknown</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Type:</span>
                            <span id="mangaType" class="meta-value">Unknown</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Status:</span>
                            <span id="status" class="meta-value">Unknown</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Language:</span>
                            <span id="language" class="meta-value">UNKNOWN</span>
                        </div>
                    </div>

                    <div class="tags-section">
                        <div class="tag-group">
                            <span class="tag-label">Genres:</span>
                            <div id="genres" class="tags"></div>
                        </div>
                        <div class="tag-group">
                            <span class="tag-label">Themes:</span>
                            <div id="themes" class="tags"></div>
                        </div>
                        <div class="tag-group">
                            <span class="tag-label">Demographic:</span>
                            <div id="demographic" class="tags"></div>
                        </div>
                    </div>

                    <div id="startReadingContainer" class="action-bar">
                        <button id="startReadingBtn" class="start-reading-btn" style="display: none;">
                            Start Reading
                        </button>
                        <button id="refetchToggleBtn" class="action-btn ghost-btn" title="Include this manga in auto updater">
                            Refetch: OFF
                        </button>
                        <button id="scrapeDetailsBtn" class="action-btn ghost-btn">
                            Update Details
                        </button>
                    </div>

                     <!-- User Actions (Hidden if not logged in) -->
                     <div id="userActions" class="user-actions" style="display: none;">
                        <h3>My List</h3>
                        
                        <div class="action-row">
                            <button id="favoriteBtn" class="action-btn">
                                <span id="favIcon">Favorite</span> <span>Favorite</span>
                            </button>
                            
                            <select id="statusSelect" class="action-select">
                                <option value="">Reading Status</option>
                                <option value="reading">Reading</option>
                                <option value="completed">Completed</option>
                                <option value="on_hold">On Hold</option>
                                <option value="dropped">Dropped</option>
                                <option value="plan_to_read">Plan to Read</option>
                            </select>

                            <select id="ratingSelect" class="action-select">
                                <option value="">Your Rating</option>
                                <option value="10">(10) Masterpiece</option>
                                <option value="9">(9) Great</option>
                                <option value="8">(8) Very Good</option>
                                <option value="7">(7) Good</option>
                                <option value="6">(6) Fine</option>
                                <option value="5">(5) Average</option>
                                <option value="4">(4) Bad</option>
                                <option value="3">(3) Very Bad</option>
                                <option value="2">(2) Horrible</option>
                                <option value="1">(1) Appalling</option>
                            </select>
                        </div>

                        <div class="notes-group">
                            <textarea id="userNote" placeholder="Add your personal notes about this manga..."></textarea>
                            <button id="saveNoteBtn" class="save-note-btn">Save Note</button>
                        </div>

                         <div class="custom-list-section">
                            <button id="addToListBtn" class="custom-list-btn">
                                Add to Custom List
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Synopsis -->
            <div class="synopsis-section">
                <h2>Synopsis</h2>
                <p id="synopsis" class="synopsis-text"></p>
            </div>

            <!-- Chapters List -->
            <div class="chapters-section">
                <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 10px;">
                    <h2>Chapters</h2>
                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Total: <span id="chapterCount">0</span></span>
                </div>
                <div class="chapters-toolbar">
                    <div class="search-wrapper">
                        <span class="search-icon">&#128269;</span>
                        <input type="text" id="chapterSearchInput" placeholder="Go to chap..." class="chapter-search-input">
                    </div>
                    
                    <button id="dlOptionsBtn" class="dl-options-btn">
                        Cloud Sync
                    </button>

                    <select id="providerFilterSelect" class="provider-filter-select">
                        <option value="all">All Providers</option>
                    </select>
                </div>

                <div class="chapters-header">
                    <div class="col-chapter" id="sortChapterBtn" style="cursor: pointer;">
                        <span>Chapter</span>
                    </div>
                    <div class="col-provider">Provider</div>
                    <div class="col-updated">Updated</div>
                    <div class="col-download">Action</div>
                </div>

                <div id="chaptersList" class="chapters-list">
                    <!-- Chapters will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p><a href="/">Back to Library</a></p>
        </footer>
    </div>

    <!-- Custom List Modal -->
    <div id="listModal" class="list-modal-overlay">
        <div class="list-modal">
            <div class="list-modal-header">
                <h3 class="list-modal-title">Custom Lists</h3>
                <button class="list-modal-close" id="closeListModal">x</button>
            </div>

            <!-- Create New List -->
            <div class="list-create-section">
                <h4>Create New List</h4>
                <div class="list-create-input-group">
                    <input type="text" id="newListInput" class="list-create-input" placeholder="Enter list name..." />
                    <button id="createListBtn" class="list-create-btn">Create</button>
                </div>
            </div>

            <!-- Existing Lists -->
            <div class="lists-section">
                <h4 id="listsHeader">Your Lists</h4>
                <div id="listItemsContainer" class="list-items">
                    <!-- Lists will be dynamically inserted here -->
                    <div class="empty-state" id="emptyState">
                        <div class="empty-state-icon">List</div>
                        <p class="empty-state-text">No lists yet. Create your first list above!</p>
                    </div>
                </div>
            </div>

            <!-- Modal Actions -->
            <div class="list-modal-actions">
                <button id="saveListsBtn" class="list-modal-btn list-modal-btn-primary">Save Changes</button>
                <button id="cancelListsBtn" class="list-modal-btn list-modal-btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Download Modal -->
    <div id="downloadModal" class="download-modal-overlay">
        <div class="download-modal">
            <div class="download-modal-header">
                <h3 class="download-modal-title">Batch Sync to Cloud</h3>
                <button class="download-modal-close" id="closeDownloadModal">x</button>
            </div>
            <div class="download-modal-body">
                <div class="download-form-group">
                    <label class="download-form-label">Select Provider</label>
                    <select id="downloadProviderSelect" class="download-form-select">
                        <option value="all">All Providers (Not Recommended)</option>
                    </select>
                </div>
                
                <div class="download-form-group">
                    <label class="download-form-label">Delay between chapters (seconds)</label>
                    <input type="number" id="downloadDelayInput" class="download-form-input" value="5" min="1" max="60">
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">
                        Higher delay helps avoid IP bans.
                    </small>
                </div>
                
                <div class="download-form-group" style="flex-direction: row; gap: 15px;">
                    <div style="flex: 1;">
                        <label class="download-form-label">Start Chapter</label>
                        <input type="number" id="downloadStartInput" class="download-form-input" placeholder="Min" step="0.1">
                    </div>
                    <div style="flex: 1;">
                        <label class="download-form-label">End Chapter</label>
                        <input type="number" id="downloadEndInput" class="download-form-input" placeholder="Max" step="0.1">
                    </div>
                </div>

                <div class="download-stats">
                    <span id="downloadTotalCount">Chapters to sync: 0</span>
                    <span id="downloadEstimatedTime">Est. time: 0m</span>
                </div>

                <div id="downloadProgressArea" class="download-progress-area">
                     <!-- Progress handled by server, showing static message -->
                    <p id="downloadProgressText" class="download-progress-text" style="text-align: left;"></p>
                </div>
            </div>
            <div class="download-modal-footer">
                <button id="cancelDownloadBtn" class="btn-secondary">Close</button>
                <button id="startDownloadBtn" class="btn-primary">Start Cloud Sync</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmModal" class="download-modal-overlay" style="z-index: 2000;">
        <div class="download-modal" style="max-width: 400px;">
            <div class="download-modal-header">
                <h3 class="download-modal-title">Confirmation</h3>
            </div>
            <div class="download-modal-body">
                <p id="confirmMessage" style="margin-bottom: 20px; line-height: 1.5; color: var(--text-primary);">
                    Are you sure?
                </p>
            </div>
            <div class="download-modal-footer">
                <button id="confirmCancelBtn" class="btn-secondary">Cancel</button>
                <button id="confirmOkBtn" class="btn-primary">Yes, Proceed</button>
            </div>
        </div>
    </div>

    <script src="js/toast.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/manga-detail.js"></script>
    <script src="js/list-modal.js"></script>
</body>
</html>



